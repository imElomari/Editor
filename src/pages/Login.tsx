import { useEffect } from 'react'
import { Auth } from '@supabase/auth-ui-react'
import { ThemeSupa } from '@supabase/auth-ui-shared'
import { supabase } from '@/lib/supabase'
import { useNavigate } from 'react-router-dom'
import { useTheme } from '@/context/ThemeContext'
import FooterNavbar from '@/pages/parts/FooterNavbar'
import { Button } from '@/components/ui/button'
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'
import { Icons } from '@/lib/constances'
import { useTranslation } from 'react-i18next'

export default function Login() {
  const navigate = useNavigate()
  const { theme, toggleTheme } = useTheme()
  const { t } = useTranslation('common')

  useEffect(() => {
    // Get initial session
    supabase.auth.getSession().then(({ data: { session } }) => {
      if (session) {
        navigate('/')
      }
    })

    // Listen for auth changes
    const {
      data: { subscription },
    } = supabase.auth.onAuthStateChange((event, session) => {
      if (event === 'SIGNED_IN' && session) {
        navigate('/')
      }
    })

    // Cleanup subscription
    return () => subscription.unsubscribe()
  }, [navigate])

  return (
    <div className="min-h-screen flex flex-col bg-background">
      <div className="flex-1 flex items-center justify-center p-4">
        <Card className="w-full max-w-md">
          <CardHeader className="space-y-4">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              id="logo_atalsimex"
              viewBox="0 0 319.8 89.6"
              className="h-14"
            >
              <g id="circle">
                <g id="v1">
                  <path
                    style={{ fill: '#6c9956' }}
                    d="M7.5 25.3C65.4 7 125.9.3 186.3 0c27.8-.3 176.8 4.7 121.2 56a128 128 0 0 1-25.2 15c6-4.2 12.4-7.8 16.6-14 20.7-40.3-54-47.6-80-50.5C148 1 77 12.5 7.5 25.3Zm25 9.5c-65.7 42.2 49 50 78 48.6 36.8 0 74-4.4 109.8-12-8.3 3-18.3 4.6-27.2 6.8-53.2 10.7-109.3 17.1-162.6 4-43.9-10.2-37.9-37.4 2-47.4Z"
                  ></path>
                  <path
                    className="fill-black dark:fill-white"
                    d="M190.4 54.3c0 2.3 0 5 .2 7.8 0 1.2.5 1.6 1.6 1.6 1.4 0 2 1.4 1.5 2.5-.3.6-.8.8-1.5.8-3-.2-6.2-.2-9.3 0-1 0-1.5-.6-1.5-1.7 0-.9 0-1.7 1.3-1.6.7 0 1.3 0 1.4-1 .3-5.5.3-11 0-16.4 0-1.4-.6-2.2-2-2.4-.5 0-1.2-.1-1-.9.3-.7-.3-1.8 1-2 2.1-.4 4.2-1 6.2-1.7.9-.4 2.1.5 2 1.4 0 1.2.5 1 1.2.6 3.8-2.2 9-3.3 12 .6.5.6.8.6 1.3.3 1.8-1 3.7-2 5.7-2.5 4.7-1.4 9 1.3 9.9 6.1.6 5.4 0 10.8.4 16.2.1 3.4 3.3 0 3.1 3.2 0 1-.3 1.8-1.5 1.8-3.2-.2-6.5-.2-9.7 0-1.2 0-1.5-.6-1.5-1.7 0-.9-.1-1.6 1.2-1.6 1.7 0 1.8-.3 2-2 .2-4.4.2-8.8 0-13.3.1-3.2-3-4.7-6.1-3.6-2.8.7-2.8.7-2.8 3.5 0 4.6 0 9.1.2 13.6 0 1.4.5 2 1.8 1.8 1.1-.2 1.3.4 1.3 1.4 0 1-.2 2-1.5 1.9-3.2-.2-6.5-.2-9.7 0-1.2 0-1.4-.7-1.4-1.7s0-1.8 1.3-1.6c1.2 0 1.7-.5 1.7-1.7.3-4.5.2-9 .2-13.5 0-3-2.4-4.6-5.8-4-3 .7-3.2.9-3.2 4v5.8ZM69.2 67h-5.6c-.7 0-1.3 0-1.6-.7-.3-.7-.2-1.6 0-2.3.1-.5.8-.3 1.2-.3 2.5-.2 2.6-.3 2-2.8-.6-2.3-1.4-4.6-2.2-6.9-.2-.6-.5-1-1.3-1-3.8.2-7.6.2-11.3.2-.6 0-1 0-1.3.7-.8 2.5-1.8 5-2.4 7.6-.3 1.8-.1 2 1.6 2.2 1.6.1 2 .7 1.6 2.2-.1.7-.6 1.1-1.3 1h-9.8c-1 0-1.3-.8-1.3-1.8 0-3 2.2.4 3.8-3.3 4.5-10.4 8.1-21.1 12.3-31.6.2-.8.6-1.4.2-2.3-.2-.5.1-1.2.8-1.4 1.4-.5 2.8-1 4.2-1.3 1-.3 1.5.3 1.7 1.2 2.4 8 5.2 15.8 7.8 23.6 1.4 4.1 2.8 8.2 4.8 12 .6 1 1.1 1.9 2.6 1.8 1.4-.1.6 1.1.7 1.7.1 1-.4 1.5-1.5 1.5h-5.8Zm-13-18h4.3c.7 0 .9-.1.6-.8l-4.3-12.7c0-.2 0-.6-.3-.6s-.3.3-.4.5l-4.8 12.7c-.3.8.1.8.7.8h4.2Zm217.9 18h-4.6c-1.3 0-1.7-.4-1.8-1.6 0-1 0-1.8 1.5-1.8 1.3.1 1.4-.2.7-1.2L266 57c-.3-.4-.5-.5-.8 0l-4.1 5.2c-.7 1-.5 1.3.7 1.4 1.7.1 1.7.1 1.6 1.9 0 1.3-.9 1.4-2 1.4a76 76 0 0 0-7.7 0c-1.7 0-2.6-1.3-1.9-2.9.2-.4.6-.4 1-.4 1.1 0 2-.5 2.6-1.3l7.2-8.8c.3-.4.3-.6 0-1l-6.2-8.3c-.5-.7-1.1-1.3-2-1.2-1.5.1-1.2-.9-1.2-1.7 0-1 .3-1.6 1.4-1.6l4.2.1 5.4-.1c.7 0 1.2.3 1.4.8.2.7.3 1.6-.1 2.3-.3.4-1 .1-1.4.2-.7 0-1 .3-.5.9 1 1.3 2 2.6 2.8 4 .3.3.5.3.7 0 .9-1.2 2-2.2 2.7-3.6.5-.9.3-1.3-.8-1.3-1.7 0-1.7-.1-1.6-1.9 0-1.2.8-1.4 1.9-1.4 2.6.2 5.2.2 7.8 0 2-.2 2 1.6 1.7 3-.1.3-.5.3-.8.3-1.2 0-2.1.6-2.8 1.5l-5.4 6.6c-.4.5-.3.8 0 1.3l7 9.4c.7.9 1.4 2 2.8 1.8 1.4 0 1.1.9 1.1 1.7 0 1-.3 1.6-1.4 1.6h-5.2Zm-139-13.3v5.6c0 .8.1 1.6.4 2.4 1 3.2 3-1 4.4 1.6.5 1 .8 1.7-.4 2.4-2.8 1.8-7.3 3-9.4-.6-.3-.6-.5-.4-.9 0-5.4 5-13.7 3-13-5.3.3-6.1 6.3-7.7 11.3-8.8 1.3-.3 1.7-1 1.5-2.2-.1-4-2-5.5-6-4.4l-2.7.9c-.8.3-1.5.2-1.9-.7-.7-1.7-.5-2.2.6-2.7a28 28 0 0 1 5.7-2.2c5.1-1.3 9.7 1 10.3 7 .2 2.3 0 4.7.1 7Zm-6 3.8q-.1-3.5-3.3-2.2c-2.8 1-4 3.3-3 6.1 1 3 4.7.6 6-1 .7-.6.2-1.6.2-2.4v-.5Z"
                  ></path>
                  <path
                    className="fill-black dark:fill-white"
                    d="M239.8 52.2h-4.3c-.7 0-1.1.1-1 1 0 2 .2 4 1.1 5.8 2.5 4.9 7.3 4.1 11 1.2 1.9-1.5 2.6.2 3.3 1.7.1.2-.1.3-.3.5-20.8 18.6-30.9-16.8-11.5-22.6 8-2.2 12 3.8 12.1 9.9 0 .6-.3.8-.8 1q-4.1 1.7-9.6 1.5Zm-.7-3.6c4 0 5.2.2 2.7-3.9-1-1.4-2.2-1.6-3.6-.7a7.7 7.7 0 0 0-3 3.8c-.2.6 0 .9.7.9h3.2ZM109 42.9v18.6c0 2.1 0 2.2 2.1 2.2 1.1 0 1.8.1 1.7 1.5-.2 1.4-.5 1.9-1.9 1.8-3.4-.1-6.8-.2-10.2 0-.7 0-1.3-.2-1.5-.8-.2-.7-.3-1.6.1-2.3.3-.4 1-.2 1.4-.2 1.7-.1 1.8-.2 1.9-1.8V30.3c0-1 .2-1.8-1.3-1.2-1.1.3-1.4-.8-1.8-1.7-.3-1 .3-1.1 1-1.4a36 36 0 0 0 6.2-3.3c.5-.3.9-.8 1.6-.4.8.5 1 1 1 1.9-.4 6.2-.4 12.4-.3 18.7Zm49.7 1.4v1.6c0 1.9 0 1.8-1.8 2.1-.7.2-1.1 0-1.3-.7-.7-2-2.3-3.8-4.6-4-1 0-1.8.2-2.3 1.2-.5 1-.4 2 .3 3a6 6 0 0 0 2.3 1.6l4 1.8c3.8 1.9 5.5 4.6 5 8.1-.3 4-2.7 7-6.6 8-3.4.8-6.6.5-9.6-1-1-.4-1.4-1-1.4-2.1 0-1.7 0-3.4-.3-5-.3-1.8 1-1.4 1.8-1.7 1.1-.5 1.1.3 1.3 1 .4 1.1 1 2.3 1.7 3.3a5.2 5.2 0 0 0 5.2 1.9c2.3-.4 3.3-3.4 1.8-5.3-.7-1-1.7-1.4-2.7-2l-4.6-2c-2.5-1.5-4.2-3.5-4.1-6.5 0-3.1 1.6-5.3 4.2-6.8a12 12 0 0 1 10.1-.7c1 .4 1.5 1 1.4 2l.1 2.2ZM81 52.8v-7.6c0-1-.2-1.3-1.2-1.3-.4 0-1.2.3-1.2-.3 0-.9-.9-1.9 0-2.7 2-2 4-3.7 6.1-5.6.6-.5 1.3-.5 2-.2.5.2.6.8.6 1.4V39c-.2.8.2 1 .9 1h6.5c1.4 0 1.8.9 1.2 2.1-.8 1.7-2 2.4-3.8 2-1.3-.2-2.7 0-4-.2-.8 0-1 .3-1 1l.1 14.2c0 2.7 2.2 4 4.7 3.1 1.4-.4 3.5-2.4 4.3-.2q.7 1.9-1 2.9a27 27 0 0 1-4.9 2.3c-4.7 1.6-8.8-1-9.2-6-.2-2.8 0-5.6 0-8.4H81Zm93-1.9c0 3.7-.3 7.3 0 11 .1 1.3.6 1.9 1.9 1.8 1.3-.1 1.2.7 1.2 1.6 0 1-.3 1.7-1.5 1.7a85 85 0 0 0-10.1 0c-1.2 0-1.4-.7-1.5-1.7 0-1 .1-1.6 1.4-1.6 2 0 2-.2 2.1-2.1.2-5 .4-9.8 0-14.8-.1-1.4-.3-2.7-2-3-.5 0-.7-.4-.5-.9.3-.6-.3-1.6.8-1.9 2-.4 4.1-1 6.1-1.8 1-.3 2.1.8 2.1 1.8v10Zm-4.3-17c-.6 0-1 0-1.3-.6l-1.9-3.3c-.5-.8-.3-1.4.6-1.9 1.2-.6 2.4-1.2 3.8-1.7.6-.2 1.1-.2 1.5.6.4 1 1 2 1.5 2.9.5.7.3 1.3-.2 1.7l-3.7 2.2h-.3Z"
                  ></path>
                </g>
              </g>
            </svg>
            <div className="flex items-center justify-between">
              <Icons.label className="h-8 w-8" />
              <CardTitle className="text-xl ms-2">Label Editor</CardTitle>
              <Button
                variant="ghost"
                size="icon"
                onClick={toggleTheme}
                aria-label={`Switch to ${theme === 'light' ? 'dark' : 'light'} mode`}
              >
                {theme === 'light' ? (
                  <Icons.moon className="h-5 w-5" />
                ) : (
                  <Icons.sun className="h-5 w-5" />
                )}
              </Button>
            </div>
            <CardDescription>{t('common:login.signin')}</CardDescription>
          </CardHeader>
          <CardContent>
            <Auth
              supabaseClient={supabase}
              appearance={{
                theme: ThemeSupa,
                variables: {
                  default: {
                    colors: {
                      brand: 'black',
                      brandAccent: 'gray',

                      brandButtonText: 'white',
                    },
                  },
                },
              }}
              providers={[]}
              theme={theme}
              redirectTo={window.location.origin}
            />
          </CardContent>
        </Card>
      </div>
      <FooterNavbar />
    </div>
  )
}
